!function(){function loadDuoshuoConfig(e){try{var t=JSON.parse(e);for(var a in t){var n=t[a];void 0!==n?a in dsConfig&&(dsConfig[a]=n):console.warn("'"+a+"' parameter is undefined.")}localStorage.setItem(Constants.DHShort,dsConfig.short_name)}catch(e){sweetAlert("出错了","解析 多说 配置出现错误，请检查语法","error"),console.log(e)}}function loadEcharts(text){var width="100%",height="400px";try{var options=eval("("+text+")");return options.hasOwnProperty("width")&&(width=options.width),options.hasOwnProperty("height")&&(height=options.height),echartIndex++,echartData.push({id:echartIndex,option:options,previousOption:text}),'<div id="echarts-'+echartIndex+'" style="width: '+width+";height:"+height+';"></div>'}catch(e){return sweetAlert("出错了","解析 ECharts 配置出现错误，请检查语法","error"),console.log(e),""}}function refreshAuto(){setInterval(load,3e3)}function load(){if(null!=targetFile){var e=new FileReader;e.readAsText(targetFile),mdName=delExtension(targetFile.name),e.onload=function(e){document.getElementById("content").innerHTML=marked(e.target.result),MathJax.Hub.Queue(["Typeset",MathJax.Hub,"content"])}}}function dragMdEnter(e){e.stopPropagation(),e.preventDefault(),$("#upload").css("border-color","#3bafda")}function dragMdLeave(e){e.stopPropagation(),e.preventDefault(),$("#upload").css("border-color","#ddd")}function dropMdFile(e){e.stopPropagation(),e.preventDefault(),$("#upload").css("border-color","#ddd"),null!=e.dataTransfer.files&&null!=e.dataTransfer.files[0]&&processMdFile(e.dataTransfer.files[0])}function selectMdFile(e){e.stopPropagation(),e.preventDefault(),null!=this.files&&null!=this.files[0]&&processMdFile(this.files[0])}function processMdFile(e){if(targetFile=e,!checkMdExt(targetFile.name)){var t=$("[data-remodal-id=md-tip]").remodal();return void t.open()}$("#loader").css("display","block");var a=new FileReader;a.readAsText(targetFile),mdName=delExtension(targetFile.name),a.onload=function(e){mdContent=e.target.result,Setting.cache?saveMdFile(mdName,mdContent):removeCacheFile(),processMdContent(mdContent)}}function resetBeforeProcess(){toc.length=0,tocStr="",echartIndex=0,echartData.length=0}function processMdContent(e){try{if(resetBeforeProcess(),calTocStart(e),setDsConfig(mdName),$("#content").html(marked(e)),replaceImage(),Setting.genToc&&genToc(),Setting.highlight==Constants.highlight?$("pre code").each(function(e,t){hljs.highlightBlock(t)}):($("pre").addClass("line-numbers"),Prism.highlightAll()),Setting.mathjax&&(null!=MathJax.Extension["TeX/AMSmath"]&&(MathJax.Extension["TeX/AMSmath"].startNumber=0,MathJax.Extension["TeX/AMSmath"].labels={}),MathJax.Hub.Queue(["Typeset",MathJax.Hub,"content"])),Setting.emoji&&emojify.run(document.getElementById("content")),Setting.sd&&$(".diagram").sequenceDiagram({theme:"simple"}),Setting.echarts){var t;echartData.forEach(function(e){t=e.option.theme?echarts.init(document.getElementById("echarts-"+e.id),e.option.theme):echarts.init(document.getElementById("echarts-"+e.id)),t.setOption(e.option)})}Setting.fancybox&&$(".fancybox-image").fancybox()}catch(e){sweetAlert("出错了","处理文件出现错误，请检查语法","error")}$("#loader").css("display","none"),collapseUpload()}function refresh(){null==targetFile?processMdContent(mdContent):processMdFile(targetFile)}function clear(){localStorage.removeItem(Constants.mdName),localStorage.removeItem(Constants.mdContent),window.location.reload()}function saveMdFile(e,t){if(t.length>maxSize){var a=$("[data-remodal-id=size-tip]").remodal();return a.open(),void removeCacheFile()}localStorage.setItem(Constants.mdName,e),localStorage.setItem(Constants.mdContent,t)}function setDsConfig(e){dsConfig.key=e,dsConfig.title=e,dsConfig.url=e+".html"}function removeCacheFile(){localStorage.removeItem(Constants.mdName),localStorage.removeItem(Constants.mdContent)}function dragImgEnter(e){e.stopPropagation(),e.preventDefault(),$("#img-upload").css("border-color","#3bafda")}function dragImgLeave(e){e.stopPropagation(),e.preventDefault(),$("#img-upload").css("border-color","#ddd")}function dropImgFile(e){e.stopPropagation(),e.preventDefault();var t=$("[data-remodal-id=modal]").remodal();t.close(),$("#img-upload").css("border-color","#ddd"),processImages(e.dataTransfer.files)}function selectImages(e){e.stopPropagation(),e.preventDefault();var t=$("[data-remodal-id=modal]").remodal();t.close(),$("#img-upload").css("border-color","#ddd"),processImages(this.files)}function processImages(e){var t,a=e.length,n=0;for(t=0;t<e.length;t++)if(!checkImgExt(e[t].name)){var o=$("[data-remodal-id=img-tip]").remodal();return void o.open()}for($("#loader").css("display","block"),t=0;t<e.length;t++){var r=e[t],s=new FileReader;s.readAsDataURL(r),function(e,t){e.onload=function(e){if(Setting.compressImg){var o=new Image;o.src=e.target.result;var r=getImgExtension(t.name),s="image/png";"jpg"!=r.toLowerCase()&&"jpeg"!=r.toLowerCase()||(s="image/jpeg"),cacheImages[t.name]=compressImage(o,s)}else cacheImages[t.name]=e.target.result;n++,n==a&&replaceImage()}}(s,r)}}function replaceImage(){var e,t=$("img");for(e=0;e<t.length;e++){var a;null==$(t[e]).attr("pname")?(a=t[e].src,$(t[e]).attr("pName",a)):a=$(t[e]).attr("pname");var n=getImgName(a);cacheImages.hasOwnProperty(n)&&(t[e].src=cacheImages[n],$(t[e]).parent().attr("href",t[e].src))}$("#loader").css("display","none")}function compressImage(e,t){var a=862,n=document.createElement("canvas"),o=e.width,r=e.height;null!=t&&""!=t||(t="image/png"),o>a&&(r=Math.round(r*=a/o),o=a),n.width=o,n.height=r;var s=n.getContext("2d");return s.drawImage(e,0,0,o,r),n.toDataURL(t)}function calTocStart(e){var t,a=/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/gim;if(tocTagPos=e.indexOf(Constants.tocTag),tocStartIndex=0,tocTagPos==-1)return void(hasTocTag=!1);for(hasTocTag=!0;null!=(t=a.exec(e))&&!(t.index>tocTagPos);)tocStartIndex++}function genToc(){var e,t,a,n=0,o=Setting.tocLevel,r="",s=0;for(minLevel=5,e=tocStartIndex;e<toc.length;e++)a=toc[e],a.level<minLevel&&(minLevel=a.level);for(n=minLevel-1,e=tocStartIndex;e<toc.length;e++)if(a=toc[e],!(a.level>o)){if(n>a.level){for(t=n-a.level;t>=0;t--)r+="</ul>",s--;r+="<ul>",s++}if(n<a.level)for(t=a.level-n;t>0;t--)r+="<ul>",s++;r+="<li><a href='#"+a.slug+"'>"+a.title+"</a></li>",n=a.level}for(e=0;e<s;e++)r+="</ul>";if(hasTocTag){var i=$("#content").html();i=i.replace(Constants.tocTag,r),$("#content").html(i)}else $("#content").prepend(r)}function loadCacheFile(){var e=localStorage.getItem(Constants.mdContent);return null==e||""==e?void $("#loader").css("display","none"):(mdName=localStorage.getItem(Constants.mdName),mdContent=e,processMdContent(mdContent),void $("#loader").css("display","none"))}function loadSetting(){var e=localStorage.getItem(Constants.setting);if(null!=e){e=JSON.parse(e);for(var t in e){var a=e[t];void 0!==a?t in Setting&&(Setting[t]=a):console.warn("'"+t+"' parameter is undefined.")}var n=localStorage.getItem(Constants.DHShort);null!=n&&(dsConfig.short_name=n)}}function saveSetting(){processMdContent(mdContent),localStorage.setItem(Constants.setting,JSON.stringify(Setting))}function addSetting(){$("[name='set']").each(function(e,t){$(t).prop("checked",Setting[$(t).attr("ref")]),$(t).change(function(e){Setting[$(t).attr("ref")]=$(t).is(":checked"),saveSetting()})}),$("#s_toc").prop("checked",Setting.genToc),$("#toc-level").val(Setting.tocLevel),$("#s_toc").change(function(e){Setting.genToc=$("#s_toc").is(":checked"),Setting.genToc?$("#toc-level").prop("disabled",!1):$("#toc-level").prop("disabled",!0),saveSetting()}),$("#toc-level").change(function(e){var t=parseInt($("#toc-level").val());t<1&&(t=1),t>5&&(t=5),Setting.tocLevel=t,$("#toc-level").val(t),saveSetting()}),Setting.highlight==Constants.highlight?$("#s_highlight").prop("checked",!0):$("#s_prism").prop("checked",!0),$("[name='high']").each(function(e,t){$(t).change(function(e){var a=$(t).prop("id");"s_highlight"==a?Setting.highlight=Constants.highlight:Setting.highlight=Constants.prism,saveSetting()})})}function exportHtml(){var e="",t="",a="";Setting.highlight==Constants.highlight?t+='<link href="http://cdn.bootcss.com/highlight.js/9.8.0/styles/atom-one-light.min.css" rel="stylesheet">':(t+='<link href="http://cdn.bootcss.com/prism/9000.0.1/themes/prism.min.css" rel="stylesheet">',t+='<link href="http://cdn.bootcss.com/prism/9000.0.1/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">'),Setting.emoji&&(t+='<link href="http://cdn.bootcss.com/emojify.js/1.1.0/css/basic/emojify.min.css" rel="stylesheet">');var n=Setting.mathjax,o=Setting.echarts;n&&(Setting.mathjax=!1,exportSetting.mathjax=!0),o&&(Setting.echarts=!1,exportSetting.echarts=!0),processMdContent(mdContent),e=$("#content").html(),Setting.mathjax=n,Setting.echarts=o,exportSetting.mathjax=!1,exportSetting.echarts=!1,processMdContent(mdContent);var r=Setting.fancybox||Setting.backtop;r&&(a+='<script src="http://cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>'),Setting.fancybox&&(t+='<link href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">',a+='<script src="http://cdn.bootcss.com/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js"></script>',a+='<script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>',a+='<script> $(".fancybox-image").fancybox();</script>'),Setting.mathjax&&(a+='<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [[\'$\',\'$\'], [\'\\\\(\',\'\\\\)\']]}, TeX: {equationNumbers: {autoNumber: ["AMS"],useLabelIds: true}},"HTML-CSS": {linebreaks: {automatic: true}},SVG: {linebreaks: {automatic: true}}});</script><script type="text/javascript" src="http://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>'),Setting.backtop&&(t+='<link href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">',t+=' <link rel="stylesheet" href="http://markdown.zhangjikai.com/dist/css/backtotop.min.css">',a+='<script type="text/javascript" src="http://markdown.zhangjikai.com/dist/js/backtotop.min.js"></script>',a+='<script type="text/javascript">backToTop.init()</script> '),Setting.duoshuo&&(a+='<div class="ds-thread" data-thread-key="'+dsConfig.key+'" data-title="'+dsConfig.title+'" data-url="'+dsConfig.url+'"></div><script type="text/javascript">var duoshuoQuery = {short_name:"'+dsConfig.short_name+'"};(function() {var ds = document.createElement("script");ds.type = "text/javascript";ds.async = true;ds.src = (document.location.protocol == "https:" ? "https:" : "http:") + "//static.duoshuo.com/embed.js";ds.charset = "UTF-8";(document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(ds);})();</script>'),Setting.echarts&&(a+="<br />",a+='<script src="http://cdn.bootcss.com/echarts/3.3.2/echarts.min.js"></script>',echartData.forEach(function(e){var t={};e.option.theme&&(t.hasOwnProperty(e.option.theme)||(echartThemeText.indexOf(e.option.theme)!=-1&&(a+='<script src="http://markdown.zhangjikai.com/dist/js/echarts-theme/'+e.option.theme+'.min.js"></script>'),t[e.option.theme]="theme"))}),a+="<br />",a+='<script type="text/javascript"> ',echartData.forEach(function(e,t){var n="";e.option.theme&&(n=e.option.theme),a+="var chart"+t+' = echarts.init(document.getElementById("echarts-'+e.id+'"),"'+n+'");\nvar option'+t+" = "+e.previousOption+";\nchart"+t+".setOption(option"+t+");\n"}),a+="</script>");var e='<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>'+mdName+"</title>"+t+'<link rel="stylesheet" href="http://markdown.zhangjikai.com/dist/css/markdown.min.css"></head><body>'+e+a+"</body></html>",s=mdName+".html";Setting.format&&(e=html_beautify(e,{indent_size:4}));var i=new Blob([e],{type:"text/html;charset=utf-8"});saveAs(i,s)}function collapseUpload(){$("#fold").removeClass("fa-minus-square"),$("#fold").addClass("fa-plus-square"),$("#upload-area").addClass("upload-area-close"),$("#fold").attr("expand",!1)}function delExtension(e){return e.substr(0,e.lastIndexOf("."))||e}function getImgName(e){return e.substr(e.lastIndexOf("/")+1)}function getImgExtension(e){return e.substr(e.lastIndexOf(".")+1)||e}function checkMdExt(e){var t=/(\.md|\.markdown|\.txt|\.mkd|\.text)$/i;return!!t.test(e)}function checkImgExt(e){var t=/(\.png|\.jpg|\.gif|\.bmp)$/i;return!!t.test(e)}var fileSelect=document.getElementById("select-file"),imgSelect=document.getElementById("img-select"),cacheImages={},targetFile,mdName="",mdContent="",maxSize=4194304,echartData=[],echartIndex=0,echartThemeText="darki infographic macarons roma shine vintage",toc=[],tocDumpIndex=0,tocStr="",tocStartIndex=0,tocTagPos=-1,hasTocTag=!1,minLevel=5,dsConfig={key:"test",title:"test",url:"test.html",short_name:"zhangjkblog"},hasDsConfig=!1,Constants={highlight:"highlight",prism:"prism",mdName:"mdName",mdContent:"mdContent",tocTag:"<!-- toc -->",setting:"setting",DHShort:"duoshuoShort"},Setting={compressImg:!0,genToc:!0,tocLevel:5,highlight:Constants.prism,cache:!0,mathjax:!0,sd:!0,emoji:!0,backtop:!0,duoshuo:!0,echarts:!0,format:!0,fancybox:!0},exportSetting={mathjax:!1,echarts:!1},renderer=new marked.Renderer;renderer.listitem=function(e){return/^\s*\[[x ]\]\s*/.test(e)?(e=e.replace(/^\s*\[ \]\s*/,'<input type="checkbox" class="task-list-item-checkbox" disabled> ').replace(/^\s*\[x\]\s*/,'<input type="checkbox" class="task-list-item-checkbox" disabled checked> '),'<li style="list-style: none">'+e+"</li>"):"<li>"+e+"</li>"},renderer.heading=function(e,t){var a=e.toLowerCase().replace(/[\s]+/g,"-");return tocStr.indexOf(a)!=-1&&(a+="-"+tocDumpIndex,tocDumpIndex++),tocStr+=a,toc.push({level:t,slug:a,title:e}),"<h"+t+' id="'+a+'"><a href="#'+a+'" class="anchor"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>'+e+"</h"+t+">"},renderer.image=function(e,t,a){var n='<div class="fancybox-image" data-fancybox-group="fancybox-gallery" href="'+e+'"><img src="'+e+'" alt="'+a+'"';return t&&(n+=' title="'+t+'"'),n+="/></div>"};var originalCodeFun=function(e,t){return Setting.highlight==Constants.highlight?"<pre><code class='"+t+"'>"+e+"</code></pre>":"<pre><code class='language-"+t+"'>"+e+"</code></pre>"};renderer.code=function(e,t){switch(t){case"seq":return Setting.sd?"<div class='diagram' id='diagram'>"+e+"</div>":originalCodeFun.call(this,e,t);case"mathjax":return Setting.mathjax||exportSetting.mathjax?"<p>"+e+"</p>\n":originalCodeFun.call(this,e,t);case"duoshuo":return Setting.duoshuo&&loadDuoshuoConfig(e),"";case"echarts":return Setting.echarts||exportSetting.echarts?loadEcharts(e):originalCodeFun.call(this,e,t);default:return originalCodeFun.call(this,e,t)}},marked.setOptions({renderer:renderer}),fileSelect.addEventListener("dragenter",dragMdEnter,!1),fileSelect.addEventListener("dragleave",dragMdLeave,!1),fileSelect.addEventListener("drop",dropMdFile,!1),fileSelect.addEventListener("change",selectMdFile,!1),imgSelect.addEventListener("dragenter",dragImgEnter,!1),imgSelect.addEventListener("dragleave",dragImgLeave,!1),imgSelect.addEventListener("drop",dropImgFile,!1),imgSelect.addEventListener("change",selectImages,!1),$("#fold").click(function(){"true"==$("#fold").attr("expand")?($("#fold").removeClass("fa-minus-square"),$("#fold").addClass("fa-plus-square"),$("#upload-area").addClass("upload-area-close"),$("#fold").attr("expand",!1)):($("#fold").removeClass("fa-plus-square"),$("#fold").addClass("fa-minus-square"),$("#upload-area").removeClass("upload-area-close"),$("#fold").attr("expand",!0))}),$("#export").click(exportHtml),$("#refresh").click(function(){refresh()}),$("#clear").click(clear),emojify.setConfig({emojify_tag_type:"div",only_crawl_id:null,img_dir:"http://cdn.bootcss.com/emojify.js/1.0/images/basic",ignored_tags:{SCRIPT:1,TEXTAREA:1,A:1,PRE:1,CODE:1}}),backToTop.init({theme:"classic",animation:"fade"}),loadSetting(),addSetting(),loadCacheFile()}();